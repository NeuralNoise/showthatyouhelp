var loadingSrc=base_url+"images/ajax-loader.gif";var refreshRate=120000;var local_stamp=Math.round(+new Date/1000);(function(b){var a=b({});b.ajaxQueue=function(g){var e,c=b.Deferred(),f=c.promise();a.queue(d);f.abort=function(j){if(e){return e.abort(j)}var h=a.queue(),i=b.inArray(d,h);if(i>-1){h.splice(i,1)}c.rejectWith(g.context||g,[f,j,""]);return f};function d(h){e=b.ajax(g).done(c.resolve).fail(c.reject).then(h,h)}return f}})(jQuery);function showMessageDialog(d,c,b,e){var a='<div style="display:none;" title="'+d+'"><p><span class="ui-icon '+b+'"></span><p class="'+e+'">'+c+"</p></p></div>";$(a).dialog({resizable:false,height:140,modal:true,buttons:{Ok:function(){$(this).dialog("close")}}})}function showErrorDialog(b,a){showMessageDialog(b,a,"ui-icon-alert","error-msg")}function showStandardDialog(b,a){showMessageDialog(b,a,"ui-icon-styh","")}function showSystemError(){showErrorDialog(messages.js_error_title,messages.js_error_msg+' <a href="'+base_url+'about/contact">'+messages.js_error_here+"</a>.")}function fetchUrl(){var a=$("#updates-list-share-answer");var b=$("#submit").attr("disabled",true);a.fadeOut("fast",function(){$(this).html('<div class="loading"></div>').fadeIn("fast",function(){var c=$("#home-share-form");$.ajaxQueue({type:"POST",url:base_url+"share/url",data:c.serialize(),dataType:"json",success:function(d){if(d.result==1){a.html(d.html);url_data=jQuery.parseJSON(d.url_json);c.children("input[name=remote]").val(1);c.children("input[name=url]").val(url_data.url);c.children("input[name=title]").val(url_data.title);c.children("input[name=description]").val(url_data.description);c.children("input[name=image]").val($(".share-images-list img.selected",a).attr("src"));c.children("input[name=icon]").val(url_data.icon);c.children("input[name=domain]").val(url_data.domain);c.children("input[name=site_name]").val(url_data.site_name);c.children("input[name=player]").val(url_data.player);b.removeAttr("disabled").val(messages.js_share_submit)}else{b.removeAttr("disabled");a.fadeOut("fast",function(){$(this).html(d.html).fadeIn("fast")})}},error:function(){b.removeAttr("disabled");a.fadeOut("fast",function(){showSystemError()})}})})})}function switchImage(e){var c=$("#share-images-counter").html().split("/");var d=parseInt($.trim(c[0]));var b=parseInt($.trim(c[1]));var a;if(e=="left"){a=(d==1)?(b):(d-1)}else{a=(d==b)?(1):(d+1)}$(".single-image-"+(d-1)).fadeOut("fast").removeClass("selected");$(".single-image-"+(a-1)).fadeIn("fast").addClass("selected");$("#home-share-form input[name=image]").val($(".share-images-list img.selected").attr("src"));$("#share-images-counter").html(a+" / "+b)}function getShareInput(a){switch(a){case"link":return'<input type="text" name="url" id="url" placeholder="'+messages.js_link+'">';case"video":return'<input type="text" name="video" id="video" placeholder="'+messages.js_video+'">';case"photo":return'<input type="text" name="photo_styled" id="photo-styled" placeholder="'+messages.js_link+'"><input type="file" name="photo" id="photo">'}}function loadNextItems(d,e){if(d.hasClass("gradient-loading")||d.is(":hidden")){return true}var f=/\/(\d+)(?!.*\d)/g;var c=d.attr("href");var b=f.exec(c);var a=$("#updates-list-load-total-pages",e);if(a.val()>(b[1]-1)){d.addClass("gradient-loading").html("&nbsp;");$.ajaxQueue({type:"GET",url:c+"/"+$("#updates-list-refresh-last").val(),success:function(h){e.before(h);var g=parseInt(b[1])+1;d.attr("href",c.replace(/\/(\d+)(?!.*\d)/g,"/"+g));d.html(messages.js_load_more).removeClass("gradient-loading");if(a.val()<=(g-1)){d.hide()}refreshTimes()}})}else{d.hide()}return true}function titleUpdatesCount(a){var b=$("title").html();if(a>0){$("title").html("("+a+") "+b.replace(/\(\d+\)/g,""))}else{$("title").html(b.replace(/\(\d+\)/g,""))}}function refreshNotifications(){setInterval(function(){$.ajaxQueue({type:"GET",url:base_url+"ajax/get_unread_notifications_count",cache:false,dataType:"json",success:function(a){$("#notifications-link").html(a.html)}})},refreshRate)}function refreshUpdates(){setInterval(function(){$.ajaxQueue({type:"GET",dataType:"json",url:base_url+"ajax/get_new_updates_count/"+$("#updates-list-refresh-last").val()+"/1",success:function(a){if(a.count>0){$("#updates-list-refresh").html(a.html).slideDown("fast")}else{$("#updates-list-refresh").html("").slideUp("fast")}titleUpdatesCount(a.count);refreshTimes()}})},refreshRate)}function refreshPosts(){setInterval(function(){$.ajaxQueue({type:"GET",url:base_url+"ajax/get_new_posts_count/"+$("#updates-list-username").val()+"/"+$("#updates-list-user-id").val()+"/"+$("#updates-list-refresh-last").val()+"/1",success:function(a){if(a.count>0){$("#updates-list-refresh").html(a.html).slideDown("fast")}else{$("#updates-list-refresh").html("").slideUp("fast")}titleUpdatesCount(a.count);refreshTimes()}})},refreshRate)}function refreshTimes(){var a=$("#updates-list-refresh-stamp");if(a.length){$("#updates-list-left small.time-since").each(function(){var g=(Math.round(+new Date/1000)-local_stamp)+(parseInt(a.val())-parseInt($(this).attr("stamp")));var e=new Array();var b=new Array();var d=new Array();e[0]=messages.js_year;b[0]=messages.js_years;d[0]=31536000;e[1]=messages.js_month;b[1]=messages.js_months;d[1]=2592000;e[2]=messages.js_week;b[2]=messages.js_weeks;d[2]=604800;e[3]=messages.js_day;b[3]=messages.js_days;d[3]=86400;e[4]=messages.js_hour;b[4]=messages.js_hours;d[4]=3600;e[5]=messages.js_minute;b[5]=messages.js_minutes;d[5]=60;e[6]=messages.js_second;b[6]=messages.js_seconds;d[6]=1;var f;for(var c=0;c<7;c++){if(g<d[c]){continue}f=Math.floor(g/d[c]);if(f>1){$(this).html(f+" "+b[c]+" "+messages.js_ago)}else{$(this).html(f+" "+e[c]+" "+messages.js_ago)}break}})}}Array.min=function(a){return Math.min.apply(Math,a)};Array.max=function(a){return Math.max.apply(Math,a)};jQuery.fn.updateCommentCount=function(a){if(a==1){$(this[0]).html("1 "+messages.js_comment)}else{$(this[0]).html(a+" "+messages.js_comments)}};jQuery.fn.insertNewHtml=function(b,a){switch(b){case"insertAfter":$(this[0]).hide().insertAfter(a).fadeIn("fast");break;case"insertBefore":$(this[0]).hide().insertBefore(a).fadeIn("fast");break;case"appendTo":$(this[0]).hide().appendTo(a).fadeIn("fast");break}};jQuery.fn.replaceThis=function(a){var b=$(this[0]);b.slideUp("fast",function(){$(a).hide().insertAfter(b).slideDown("fast",function(){b.remove()})})};jQuery(function(){jQuery.support.placeholder=false;test=document.createElement("input");if("placeholder" in test){jQuery.support.placeholder=true}});$(document).ready(function(){var c=$("#updates-list-right");var f=$("#updates-list-refresh-wrap");if(!$.support.placeholder){$("[placeholder]").live("focus",function(){var n=$(this);if(n.val()==n.attr("placeholder")){if(n.setSelectionRange){n.setSelectionRange(0,0)}else{if(n.get(0).createTextRange){var m=n.get(0).createTextRange();m.collapse(true);m.moveEnd("character",0);m.moveStart("character",0);m.select()}}}}).live("keydown",function(){var m=$(this);if(m.val()==m.attr("placeholder")){m.val("");m.removeClass("placeholder")}}).live("blur",function(){var m=$(this);if(m.val()==""||m.val()==m.attr("placeholder")){m.addClass("placeholder");m.val(m.attr("placeholder"))}}).blur();$("form").submit(function(){$(this).find("[placeholder]").each(function(){var m=$(this);if(m.val()==m.attr("placeholder")){m.val("")}})})}var g=$("#settings-form");if(g.length==0){g=$("#sign-up-form")}if(g[0]){$("input.validate-focusout",g).focusout(function(){var m=$(this);var o=m.attr("id");var n={};n[o]=m.val();if(o=="password_confirm"){n.password=$("input#password",g).val()}$.ajaxQueue({type:"POST",url:base_url+"ajax/validate_sign_up",data:n,dataType:"json",cache:false,success:function(p){if(p.result==0){m.addClass("error_box");$("#error_"+o,g).html(p[o])}else{m.removeClass("error_box");$("#error_"+o,g).html("")}}})});g.submit(function(){var m=$(this);var n=$("input.error_box",m);if(n.length){n.addClass("animated tada");var o=window.setTimeout(function(){n.removeClass("animated tada")},1300);return false}else{$.ajaxQueue({type:"POST",url:base_url+"ajax/validate_sign_up",data:m.serialize(),dataType:"json",cache:false,success:function(q){if(q.result==0){for(var p in q){if(p!="result"&&q[p]!=""){$("#"+p,m).addClass("error_box");$("#error_"+p,m).html(q[p])}}return false}else{return true}}})}});$("#bio",g).keyup(function(){var m=255-$(this).val().length;if(m<0){$(this).val($(this).val().substring(0,255));$("#bio-length-remaining",g).text(0);return false}$("#bio-length-remaining",g).text(m)})}var i=$("#home-share-form");if(i[0]){$("#url",i).live("focus",function(){var m=i.children("input[type=submit]");m.val("Preview")});$("#video",i).live("focus",function(){var m=i.children("input[type=submit]");m.val("Preview")});$("#share-images-left").live("click",function(){switchImage("left")});$("#share-images-right").live("click",function(){switchImage("right")});$("#update-list-share-btns a.share-btn-action").click(function(){var o=i;o.children("input[type=submit]").val(messages.js_share_submit);var p=o.find("#update-list-share-add");var m=$(this).attr("href");var n=m.substr(m.lastIndexOf("/")+1);var q=o.children("input[name=type]").val();if(n==q){return false}o.children("textarea").removeClass("error_box");$("#update-list-share-btns a.share-btn-action.selected").removeClass("selected");$(this).addClass("selected");o.children("input[name=type]").val(n);if(q=="link"){q="url"}if(n=="text"&&q!="text"){p.fadeOut("fast",function(){$(this).html("")})}else{if(n!="text"&&q=="text"){p.html(getShareInput(n)).fadeIn("fast",function(){if(!$.support.placeholder){$("[placeholder]",p).each(function(){var r=$(this);if(r.val()==""||r.val()==r.attr("placeholder")){r.addClass("placeholder");r.val(r.attr("placeholder"))}})}})}else{p.fadeOut("fast",function(){$(this).html(getShareInput(n)).fadeIn("fast",function(){if(!$.support.placeholder){$("[placeholder]",p).each(function(){var r=$(this);if(r.val()==""||r.val()==r.attr("placeholder")){r.addClass("placeholder");r.val(r.attr("placeholder"))}})}})})}}$("#updates-list-share-answer").fadeOut("fast",function(){$(this).html("")});return false});$("#home-share-comment").focus(function(){$(this).animate({width:"500px",height:"100px",boxShadow:"0 0 5px #000"}).addClass("animate")});$("#home-share-comment").focusout(function(){$(this).animate({width:"258px",height:"50px",boxShadow:"0 0 0 #000"}).removeClass("animate")});$("#photo").live("change",function(){var o=/^.*[\/\\](.*)$/i;var n=$(this).val();var m=o.exec(n);if(m!=null){n=m[1]}$("#photo-styled").val(n)});i.submit(function(){var o=$(this);var m=o.children("input[type=submit]");if(m.val()=="Preview"){fetchUrl();return false}m.attr("disabled",true);o.children("input[name=remote]").val(1);var n=o.children("input[name=type]").val();var p=$('<div class="loading-wrap"><div class="loading-inner"></div></div>').hide();if(n=="photo"){p.appendTo(o.parent()).fadeIn("fast");return true}if(n=="link"){n="url"}p.appendTo(o.parent()).fadeIn("fast",function(){$.ajaxQueue({type:"POST",url:o.attr("action"),data:o.serialize(),dataType:"json",cache:false,success:function(q){if(q.result==1){o.children("textarea").val("").removeClass("error_box");if(n!="text"){o.find("input[name="+n+"]").val("").removeClass("error_box")}$("#updates-list-share-answer").fadeOut("fast",function(){$(this).html("")})}else{q.fields=jQuery.parseJSON(q.fields);if(q.fields.comment!=""){o.children("textarea").addClass("error_box")}if(q.fields.url!=""){o.children("input[name=url]").addClass("error_box")}if(q.fields.video!=""){o.children("input[name=video]").addClass("error_box")}if(q.fields.photo!=""){o.children("input[name=photo]").addClass("error_box")}$("#updates-list-share-answer").html(q.html).fadeIn("fast")}m.removeAttr("disabled");p.remove()},error:function(){m.removeAttr("disabled");p.remove();showSystemError()}});$.ajaxQueue({type:"GET",dataType:"json",url:base_url+"ajax/get_new_updates_count/"+$("#updates-list-refresh-last").val()+"/1",success:function(q){if(q.count>0){$("#updates-list-refresh").html(q.html).slideDown("fast")}else{$("#updates-list-refresh").html("").slideUp("fast")}titleUpdatesCount(q.count)}})});return false})}var b=$("#updates-list-load-wrap");if(b[0]){var k=$("#updates-list-load",b);if(k[0]){$("#updates-list-load-more-pages",b).hide();k.css("display","inline-block").click(function(){loadNextItems(k,b);return false});loadNextItems(k,b);$(window).scroll(function(){if($(window).scrollTop()+$(window).height()>$(document).height()-300){loadNextItems(k,b)}})}}if(f[0]){var j=$("#updates-list-refresh-type",f).val();var d="";if(j=="home"){refreshUpdates();d=base_url+"ajax/display_new_updates/"}else{if(j=="profile"){refreshPosts();d=base_url+"ajax/display_new_posts/"+$("#updates-list-user-id",f).val()+"/"}}$("#updates-list-refresh-url",f).live("click",function(){var n=$(this).parent();var m=$("#updates-list-refresh-last",f);n.slideUp("fast",function(){$.ajaxQueue({type:"GET",url:d+m.val(),success:function(o){$(o).hide().insertAfter(n).slideDown("fast",function(){var p=n.next().attr("id");p=p.split("-");m.val(p[1]);titleUpdatesCount(0);refreshTimes()})}})});return false})}$("a.remove-update-action").live("click",function(){var n=$(this).parent();var m=n.attr("id");m=m.split("-");$.ajaxQueue({type:"GET",url:base_url+"ajax/update_delete/"+m[1],success:function(o){n.replaceThis(o);refreshTimes()}});return false});$("a.update-delete-undo-action").live("click",function(){var n=$(this).parent();var m=$(this).attr("href");$.ajaxQueue({type:"GET",url:m,cache:false,success:function(o){n.replaceThis(o);refreshTimes()}});return false});$("a.connect-action").live("click",function(){var o=$(this);var p=/^.*\/(.*)$/g;var n=o.attr("href");var m=p.exec(n);var r=m[1];var q=$('<div class="loading-btn"></div>');o.append(q);$.ajaxQueue({type:"GET",url:n,dataType:"json",cache:false,success:function(s){q.remove();if(s.result==1){$("a.connect-"+r).each(function(){$(this).removeClass("connect-action").addClass("disconnect-action gradient-red").attr("href",base_url+"user/disconnect/"+r);var t=$(this).children("i");if(t.length){t.removeClass("connect-btn").addClass("disconnect-btn")}else{$(this).html(messages.js_disconnect)}})}else{showSystemError()}}});return false});$("a.disconnect-action").live("click",function(){var o=$(this);var p=/^.*\/(.*)$/g;var n=o.attr("href");var m=p.exec(n);var r=m[1];var q=$('<div class="loading-btn"></div>');o.append(q);$.ajaxQueue({type:"GET",url:n,dataType:"json",cache:false,success:function(s){q.remove();if(s.result==1){$("a.connect-"+r).each(function(){$(this).removeClass("disconnect-action gradient-red").addClass("connect-action").attr("href",base_url+"user/connect/"+r);var t=$(this).children("i");if(t.length){t.removeClass("disconnect-btn").addClass("connect-btn")}else{$(this).html(messages.js_connect)}})}else{showSystemError()}}});return false});if(c[0]){$("#user-invite-form").submit(function(){var o=$(this);var m=o.closest(".updates-list-invite");var n=$("#updates-list-invite-count");var p=$('<div class="loading-wrap"><div class="loading-inner"></div></div>');m.append(p);$.ajaxQueue({type:"POST",url:o.attr("action"),data:o.serialize(),dataType:"json",cache:false,success:function(q){if(q.result==1){o.children("input[type=text]").removeClass("error_box").val("");$("#updates-list-invite-answer").html("").slideUp("fast");n.html(parseInt(n.html())-1);showStandardDialog(messages.js_invitation_sent,messages.js_invitation_msg);if(parseInt(n.html())==1){m.slideUp("fast").remove()}}else{o.children("input[type=text]").addClass("error_box");$("#updates-list-invite-answer").html(q.error).slideDown("fast")}p.remove()},error:function(){p.remove();showSystemError()}});return false})}$("a.updates-item-share-btn").live("click",function(){var m=$(this).prev();m.animate({width:parseInt(m.css("width"))==0?"108":"0"});return false});$("a.remote-share-action").live("click",function(){window.open($(this).attr("href"),"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=400,width=600");return false});$("a.local-share-action").live("click",function(){var n='<div title="'+messages.js_share+'"></div>';var m={};m[messages.js_share]=function(){var p=$(this);var q=$("#update-share-form form");var o=q.children("input[type=submit]");o.attr("disabled",true);var r=$('<div class="loading-wrap"><div class="loading-inner"></div></div>').hide();r.appendTo(q.parent().parent()).fadeIn("fast",function(){$.ajaxQueue({type:"POST",url:q.attr("action"),data:q.serialize(),dataType:"json",cache:false,success:function(s){if(s.result==1){q.children("textarea").val("").removeClass("error_box");$("#updates-list-share-answer").fadeOut("fast",function(){$(this).html("")});p.dialog("close")}else{s.fields=jQuery.parseJSON(s.fields);if(s.fields.comment!=""){q.children("textarea").addClass("error_box")}$("#updates-list-share-answer").html(s.html).fadeIn("fast")}o.removeAttr("disabled");r.remove()},error:function(){o.removeAttr("disabled");r.remove();showSystemError()}})})};$(n).load($(this).attr("href")).dialog({resizable:false,width:400,modal:true,buttons:m,close:function(){$.ajaxQueue({type:"GET",dataType:"json",url:base_url+"ajax/get_new_updates_count/"+$("#updates-list-refresh-last").val()+"/1",success:function(o){if(o.count>0){$("#updates-list-refresh").html(o.html).slideDown("fast")}else{$("#updates-list-refresh").html("").slideUp("fast")}titleUpdatesCount(o.count)}})}});return false});$("#comment-textarea").focus(function(){$(this).animate({height:"4em"})});$("a.view-comments-action").live("click",function(){var o=$(this);var p=o.parent();var s=p.children(".updates-item-comments-wrap");var r=p.children(".updates-item-comment-form");var q=/\/(\d+)(?!.*\d)/g;var n=o.attr("href");var m=q.exec(n);var t=$('<div class="loading-btn"></div>');o.append(t);if(s.length){s.fadeTo("fast",0.5,function(){$.ajaxQueue({type:"GET",url:base_url+"ajax/display_comment_list/"+m[1],cache:false,success:function(u){t.remove();o.updateCommentCount($(u).children().length);s.replaceWith(u)},error:function(){t.remove();showSystemError()}})});return false}$.ajaxQueue({type:"GET",url:base_url+"ajax/display_comment_list/"+m[1],cache:false,success:function(u){t.remove();var v=$(u).hide();if(r.length){v.insertBefore(r).fadeIn("fast")}else{v.appendTo(p).fadeIn("fast")}o.updateCommentCount($(u).children().length)},error:function(){t.remove();showSystemError()}});return false});$("a.comment-btn-click").live("click",function(){var o=$(this);var p=o.parent();if(o.hasClass("selected")){o.removeClass("selected");p.children(".updates-item-comment-form").fadeOut("fast",function(){$(this).remove()})}else{var r=$('<div class="loading-btn"></div>');o.append(r);var q=/\/(\d+)(?!.*\d)/g;var n=o.attr("href");var m=q.exec(n);$.ajaxQueue({type:"GET",url:base_url+"ajax/display_comment_form/"+m[1],cache:false,success:function(s){o.addClass("selected");r.remove();$(s).insertNewHtml("appendTo",p)},error:function(){r.remove();showSystemError()}})}return false});$("#comment_form").live("submit",function(){var n=$(this);if(n.children("textarea").val()==""){n.children("textarea").addClass("error_box");return false}else{n.children("textarea").removeClass("error_box")}var o=n.prev();var m=o.parent().parent();var p=m.children(".updates-view-comments-btn");o.html('<div class="loading"></div>').fadeIn("fast",function(){$.ajaxQueue({type:"POST",url:base_url+"share/comment",data:n.serialize(),dataType:"json",cache:false,success:function(q){o.fadeOut("fast",function(){o.html("");if(q.result==1){var r=o.parent().prev();if(r.hasClass("updates-item-comments-wrap")){$(q.html_single).hide().appendTo(r).fadeIn("fast")}else{$(q.html).hide().insertBefore(o.parent()).fadeIn("fast")}n.children("textarea").val("");if(p.length){p.updateCommentCount(parseInt(p.html())+1)}}else{$(q.html).hide().appendTo(o.show()).fadeIn("fast")}})},error:function(){showSystemError()}})});return false});$("a.comment-remove-action").live("click",function(){var m=$(this);$.ajaxQueue({type:"GET",url:m.attr("href"),dataType:"json",cache:false,success:function(o){if(o.result==1){var n=m.closest(".updates-list-item");var p=n.children(".updates-view-comments-btn");m.parent().fadeOut("fast",function(){$(this).remove();p.updateCommentCount(parseInt(p.html())-1)})}},error:function(){showSystemError()}});return false});var a=$("#notifications-link");if(a[0]){refreshNotifications();a.click(function(){var m=$(this);if(m.hasClass("selected")){m.removeClass("selected");var n=$("#notifications-window");if(n.length>0){n.hide();n.remove()}}else{var o=$('<div class="loading-btn"></div>');m.addClass("selected").append(o);$.ajaxQueue({type:"GET",url:m.attr("href"),cache:false,success:function(p){o.remove();$(p).hide().appendTo(m.parent()).show()},error:function(){o.remove();showSystemError()}})}return false});$(document).click(function(n){var m=$("#notifications-window");if((m.has(n.target).length===0)&&(n.target!==a)&&(a.hasClass("selected"))){a.removeClass("selected");if(m.length>0){m.hide();m.remove()}}})}if(c[0]){$("#mark-all-read",c).click(function(){$.ajaxQueue({type:"GET",url:$(this).attr("href"),dataType:"json",cache:false,success:function(m){if(m.result==1){$("div.updates-list-item.unread").removeClass("unread");$("#notifications-link").html("Notifications")}},error:function(){showSystemError()}});return false})}if(c[0]){var l=$("div.fixed-block",c);if(l.length){var h=$("div.relative-block",c);$(window).scroll(function(){if($(window).scrollTop()>(h.offset().top+h.outerHeight()-$("#top-navigation").outerHeight())){l.css("position","fixed").css("top","32px")}else{l.css("position","relative").css("top","0")}})}}var e=$("#top-navigation-menu-icon");if(e[0]){e.parent().removeClass("menu").find("ul").hide();e.click(function(){var m=e.parent();var n=$("#top-navigation-menu-window");if(m.hasClass("selected")){n.hide();m.removeClass("selected")}else{m.addClass("selected");n.show()}});$(document).click(function(o){var m=e.parent();var n=$("#top-navigation-menu-window");if((n.has(o.target).length===0)&&($(o.target).attr("id")!==e.attr("id"))&&(m.hasClass("selected"))){n.hide();m.removeClass("selected")}})}});