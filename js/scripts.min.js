function showMessageDialog(e,t,n,r){var i='<div style="display:none;" title="'+e+'">'+'<p><span class="ui-icon '+n+'"></span>'+'<p class="'+r+'">'+t+"</p></p>"+"</div>";$(i).dialog({resizable:false,height:140,modal:true,buttons:{Ok:function(){$(this).dialog("close")}}})}function showErrorDialog(e,t){showMessageDialog(e,t,"ui-icon-alert","error-msg")}function showStandardDialog(e,t){showMessageDialog(e,t,"ui-icon-styh","")}function showSystemError(){showErrorDialog(messages.js_error_title,messages.js_error_msg+' <a href="'+base_url+'about/contact">'+messages.js_error_here+"</a>.")}function fetchUrl(){var e=$("#updates-list-share-answer");var t=$("#submit").attr("disabled",true);e.fadeOut("fast",function(){$(this).html('<div class="loading"></div>').fadeIn("fast",function(){var n=$("#home-share-form");$.ajaxQueue({type:"POST",url:base_url+"share/url",data:n.serialize(),dataType:"json",success:function(r){if(r.result==1){e.html(r.html);url_data=jQuery.parseJSON(r.url_json);n.children("input[name=remote]").val(1);n.children("input[name=url]").val(url_data.url);n.children("input[name=title]").val(url_data.title);n.children("input[name=description]").val(url_data.description);n.children("input[name=image]").val($(".share-images-list img.selected",e).attr("src"));n.children("input[name=icon]").val(url_data.icon);n.children("input[name=domain]").val(url_data.domain);n.children("input[name=site_name]").val(url_data.site_name);n.children("input[name=player]").val(url_data.player);t.removeAttr("disabled").val(messages.js_share_submit)}else{t.removeAttr("disabled");e.fadeOut("fast",function(){$(this).html(r.html).fadeIn("fast")})}},error:function(){t.removeAttr("disabled");e.fadeOut("fast",function(){showSystemError()})}})})})}function switchImage(e){var t=$("#share-images-counter").html().split("/");var n=parseInt($.trim(t[0]));var r=parseInt($.trim(t[1]));var i;if(e=="left")i=n==1?r:n-1;else i=n==r?1:n+1;$(".single-image-"+(n-1)).fadeOut("fast").removeClass("selected");$(".single-image-"+(i-1)).fadeIn("fast").addClass("selected");$("#home-share-form input[name=image]").val($(".share-images-list img.selected").attr("src"));$("#share-images-counter").html(i+" / "+r)}function getShareInput(e){switch(e){case"link":return'<input type="text" name="url" id="url" placeholder="'+messages.js_link+'">';case"video":return'<input type="text" name="video" id="video" placeholder="'+messages.js_video+'">';case"photo":return'<input type="text" name="photo_styled" id="photo-styled" placeholder="'+messages.js_photo+'"><input type="file" name="photo" id="photo">'}}function loadNextItems(e,t){if(e.hasClass("gradient-loading")||e.is(":hidden"))return true;var n=/\/(\d+)(?!.*\d)/g;var r=e.attr("href");var i=n.exec(r);var s=$("#updates-list-load-total-pages",t);if(s.val()>i[1]-1){e.addClass("gradient-loading").html("&nbsp;");$.ajaxQueue({type:"GET",url:r+"/"+$("#updates-list-refresh-last").val(),success:function(n){t.before(n);var o=parseInt(i[1])+1;e.attr("href",r.replace(/\/(\d+)(?!.*\d)/g,"/"+o));e.html(messages.js_load_more).removeClass("gradient-loading");if(s.val()<=o-1){e.hide()}refreshTimes()}})}else{e.hide()}return true}function titleUpdatesCount(e){var t=$("title").html();if(e>0)$("title").html("("+e+") "+t.replace(/\(\d+\)/g,""));else $("title").html(t.replace(/\(\d+\)/g,""))}function refreshNotifications(){setInterval(function(){$.ajaxQueue({type:"GET",url:base_url+"ajax/get_unread_notifications_count",cache:false,dataType:"json",success:function(e){$("#notifications-link").html(e.html)}})},refreshRate)}function refreshUpdates(){setInterval(function(){$.ajaxQueue({type:"GET",dataType:"json",url:base_url+"ajax/get_new_updates_count/"+$("#updates-list-refresh-last").val()+"/1",success:function(e){if(e.count>0)$("#updates-list-refresh").html(e.html).slideDown("fast");else $("#updates-list-refresh").html("").slideUp("fast");titleUpdatesCount(e.count);refreshTimes()}})},refreshRate)}function refreshPosts(){setInterval(function(){$.ajaxQueue({type:"GET",url:base_url+"ajax/get_new_posts_count/"+$("#updates-list-username").val()+"/"+$("#updates-list-user-id").val()+"/"+$("#updates-list-refresh-last").val()+"/1",success:function(e){if(e.count>0)$("#updates-list-refresh").html(e.html).slideDown("fast");else $("#updates-list-refresh").html("").slideUp("fast");titleUpdatesCount(e.count);refreshTimes()}})},refreshRate)}function refreshTimes(){var e=$("#updates-list-refresh-stamp");if(e.length){$("#updates-list-left small.time-since").each(function(){var t=Math.round(+(new Date)/1e3)-local_stamp+(parseInt(e.val())-parseInt($(this).attr("stamp")));var n=new Array;var r=new Array;var i=new Array;n[0]=messages.js_year;r[0]=messages.js_years;i[0]=31536e3;n[1]=messages.js_month;r[1]=messages.js_months;i[1]=2592e3;n[2]=messages.js_week;r[2]=messages.js_weeks;i[2]=604800;n[3]=messages.js_day;r[3]=messages.js_days;i[3]=86400;n[4]=messages.js_hour;r[4]=messages.js_hours;i[4]=3600;n[5]=messages.js_minute;r[5]=messages.js_minutes;i[5]=60;n[6]=messages.js_second;r[6]=messages.js_seconds;i[6]=1;var s;for(var o=0;o<7;o++){if(t<i[o])continue;s=Math.floor(t/i[o]);if(s>1)$(this).html(s+" "+r[o]+" "+messages.js_ago);else $(this).html(s+" "+n[o]+" "+messages.js_ago);break}})}}var loadingSrc=base_url+"images/ajax-loader.gif";var refreshRate=12e4;var local_stamp=Math.round(+(new Date)/1e3);(function(e){var t=e({});e.ajaxQueue=function(n){function o(t){r=e.ajax(n).done(i.resolve).fail(i.reject).then(t,t)}var r,i=e.Deferred(),s=i.promise();t.queue(o);s.abort=function(u){if(r){return r.abort(u)}var a=t.queue(),f=e.inArray(o,a);if(f>-1){a.splice(f,1)}i.rejectWith(n.context||n,[s,u,""]);return s};return s}})(jQuery);Array.min=function(e){return Math.min.apply(Math,e)};Array.max=function(e){return Math.max.apply(Math,e)};jQuery.fn.updateCommentCount=function(e){if(e==1)$(this[0]).html("1 "+messages.js_comment);else $(this[0]).html(e+" "+messages.js_comments)};jQuery.fn.insertNewHtml=function(e,t){switch(e){case"insertAfter":$(this[0]).hide().insertAfter(t).fadeIn("fast");break;case"insertBefore":$(this[0]).hide().insertBefore(t).fadeIn("fast");break;case"appendTo":$(this[0]).hide().appendTo(t).fadeIn("fast");break}};jQuery.fn.replaceThis=function(e){var t=$(this[0]);t.slideUp("fast",function(){$(e).hide().insertAfter(t).slideDown("fast",function(){t.remove()})})};jQuery(function(){jQuery.support.placeholder=false;test=document.createElement("input");if("placeholder"in test)jQuery.support.placeholder=true});$(document).ready(function(){var e=$("#updates-list-right");var t=$("#updates-list-refresh-wrap");if(!$.support.placeholder){$("[placeholder]").live("focus",function(){var e=$(this);if(e.val()==e.attr("placeholder")){if(e.setSelectionRange){e.setSelectionRange(0,0)}else if(e.get(0).createTextRange){var t=e.get(0).createTextRange();t.collapse(true);t.moveEnd("character",0);t.moveStart("character",0);t.select()}}}).live("keydown",function(){var e=$(this);if(e.val()==e.attr("placeholder")){e.val("");e.removeClass("placeholder")}}).live("blur",function(){var e=$(this);if(e.val()==""||e.val()==e.attr("placeholder")){e.addClass("placeholder");e.val(e.attr("placeholder"))}}).blur();$("form").submit(function(){$(this).find("[placeholder]").each(function(){var e=$(this);if(e.val()==e.attr("placeholder")){e.val("")}})})}var n=$("#settings-form");if(n.length==0)n=$("#sign-up-form");if(n[0]){$("input.validate-focusout",n).focusout(function(){var e=$(this);var t=e.attr("id");var r={};r[t]=e.val();if(t=="password_confirm")r["password"]=$("input#password",n).val();$.ajaxQueue({type:"POST",url:base_url+"ajax/validate_sign_up",data:r,dataType:"json",cache:false,success:function(r){if(r.result==0){e.addClass("error_box");$("#error_"+t,n).html(r[t])}else{e.removeClass("error_box");$("#error_"+t,n).html("")}}})});n.submit(function(){var e=$(this);var t=$("input.error_box",e);if(t.length){t.addClass("animated tada");var n=window.setTimeout(function(){t.removeClass("animated tada")},1300);return false}else{$.ajaxQueue({type:"POST",url:base_url+"ajax/validate_sign_up",data:e.serialize(),dataType:"json",cache:false,success:function(t){if(t.result==0){for(var n in t){if(n!="result"&&t[n]!=""){$("#"+n,e).addClass("error_box");$("#error_"+n,e).html(t[n])}}return false}else{return true}}})}});$("#bio",n).keyup(function(){var e=255-$(this).val().length;if(e<0){$(this).val($(this).val().substring(0,255));$("#bio-length-remaining",n).text(0);return false}$("#bio-length-remaining",n).text(e)})}var r=$("#home-share-form");if(r[0]){$("#url",r).live("focus",function(){var e=r.children("input[type=submit]");e.val("Preview")});$("#video",r).live("focus",function(){var e=r.children("input[type=submit]");e.val("Preview")});$("#share-images-left").live("click",function(){switchImage("left")});$("#share-images-right").live("click",function(){switchImage("right")});$("#update-list-share-btns a.share-btn-action").click(function(){var e=r;e.children("input[type=submit]").val(messages.js_share_submit);var t=e.find("#update-list-share-add");var n=$(this).attr("href");var i=n.substr(n.lastIndexOf("/")+1);var s=e.children("input[name=type]").val();if(i==s)return false;e.children("textarea").removeClass("error_box");$("#update-list-share-btns a.share-btn-action.selected").removeClass("selected");$(this).addClass("selected");e.children("input[name=type]").val(i);if(s=="link")s="url";if(i=="text"&&s!="text"){t.fadeOut("fast",function(){$(this).html("")})}else if(i!="text"&&s=="text"){t.html(getShareInput(i)).fadeIn("fast",function(){if(!$.support.placeholder){$("[placeholder]",t).each(function(){var e=$(this);if(e.val()==""||e.val()==e.attr("placeholder")){e.addClass("placeholder");e.val(e.attr("placeholder"))}})}})}else{t.fadeOut("fast",function(){$(this).html(getShareInput(i)).fadeIn("fast",function(){if(!$.support.placeholder){$("[placeholder]",t).each(function(){var e=$(this);if(e.val()==""||e.val()==e.attr("placeholder")){e.addClass("placeholder");e.val(e.attr("placeholder"))}})}})})}$("#updates-list-share-answer").fadeOut("fast",function(){$(this).html("")});return false});$("#home-share-comment").focus(function(){$(this).animate({height:"100px"}).addClass("animate")});$("#home-share-comment").focusout(function(){$(this).animate({height:"30px"}).removeClass("animate")});$("#photo").live("change",function(){var e=/^.*[\/\\](.*)$/i;var t=$(this).val();var n=e.exec(t);if(n!=null)t=n[1];$("#photo-styled").val(t)});r.submit(function(){var e=$(this);var t=e.children("input[type=submit]");if(t.val()=="Preview"){fetchUrl();return false}t.attr("disabled",true);e.children("input[name=remote]").val(1);var n=e.children("input[name=type]").val();var r=$('<div class="loading-wrap"><div class="loading-inner"></div></div>').hide();if(n=="photo"){r.appendTo(e.parent()).fadeIn("fast");return true}if(n=="link")n="url";r.appendTo(e.parent()).fadeIn("fast",function(){$.ajaxQueue({type:"POST",url:e.attr("action"),data:e.serialize(),dataType:"json",cache:false,success:function(i){if(i.result==1){e.children("textarea").val("").removeClass("error_box");if(n!="text")e.find("input[name="+n+"]").val("").removeClass("error_box");$("#updates-list-share-answer").fadeOut("fast",function(){$(this).html("")})}else{i.fields=jQuery.parseJSON(i.fields);if(i.fields.comment!="")e.children("textarea").addClass("error_box");if(i.fields.url!="")e.children("input[name=url]").addClass("error_box");if(i.fields.video!="")e.children("input[name=video]").addClass("error_box");if(i.fields.photo!="")e.children("input[name=photo]").addClass("error_box");$("#updates-list-share-answer").html(i.html).fadeIn("fast")}t.removeAttr("disabled");r.remove()},error:function(){t.removeAttr("disabled");r.remove();showSystemError()}});$.ajaxQueue({type:"GET",dataType:"json",url:base_url+"ajax/get_new_updates_count/"+$("#updates-list-refresh-last").val()+"/1",success:function(e){if(e.count>0)$("#updates-list-refresh").html(e.html).slideDown("fast");else $("#updates-list-refresh").html("").slideUp("fast");titleUpdatesCount(e.count)}})});return false})}var i=$("#updates-list-load-wrap");if(i[0]){var s=$("#updates-list-load",i);if(s[0]){$("#updates-list-load-more-pages",i).hide();s.css("display","inline-block").click(function(){loadNextItems(s,i);return false});loadNextItems(s,i);$(window).scroll(function(){if($(window).scrollTop()+$(window).height()>$(document).height()-300)loadNextItems(s,i)})}}if(t[0]){var o=$("#updates-list-refresh-type",t).val();var u="";if(o=="home"){refreshUpdates();u=base_url+"ajax/display_new_updates/"}else if(o=="profile"){refreshPosts();u=base_url+"ajax/display_new_posts/"+$("#updates-list-user-id",t).val()+"/"}$("#updates-list-refresh-url",t).live("click",function(){var e=$(this).parent();var n=$("#updates-list-refresh-last",t);e.slideUp("fast",function(){$.ajaxQueue({type:"GET",url:u+n.val(),success:function(t){$(t).hide().insertAfter(e).slideDown("fast",function(){var t=e.next().attr("id");t=t.split("-");n.val(t[1]);titleUpdatesCount(0);refreshTimes()})}})});return false})}$("a.remove-update-action").live("click",function(){var e=$(this).parent();var t=e.attr("id");t=t.split("-");$.ajaxQueue({type:"GET",url:base_url+"ajax/update_delete/"+t[1],success:function(t){e.replaceThis(t);refreshTimes()}});return false});$("a.update-delete-undo-action").live("click",function(){var e=$(this).parent();var t=$(this).attr("href");$.ajaxQueue({type:"GET",url:t,cache:false,success:function(t){e.replaceThis(t);refreshTimes()}});return false});$("a.connect-action").live("click",function(){var e=$(this);var t=/^.*\/(.*)$/g;var n=e.attr("href");var r=t.exec(n);var i=r[1];var s=$('<div class="loading-btn"></div>');e.append(s);$.ajaxQueue({type:"GET",url:n,dataType:"json",cache:false,success:function(e){s.remove();if(e.result==1){$("a.connect-"+i).each(function(){$(this).removeClass("connect-action").addClass("disconnect-action gradient-red").attr("href",base_url+"user/disconnect/"+i);var e=$(this).children("i");if(e.length)e.removeClass("connect-btn").addClass("disconnect-btn");else $(this).html(messages.js_disconnect)})}else{showSystemError()}}});return false});$("a.disconnect-action").live("click",function(){var e=$(this);var t=/^.*\/(.*)$/g;var n=e.attr("href");var r=t.exec(n);var i=r[1];var s=$('<div class="loading-btn"></div>');e.append(s);$.ajaxQueue({type:"GET",url:n,dataType:"json",cache:false,success:function(e){s.remove();if(e.result==1){$("a.connect-"+i).each(function(){$(this).removeClass("disconnect-action gradient-red").addClass("connect-action").attr("href",base_url+"user/connect/"+i);var e=$(this).children("i");if(e.length)e.removeClass("disconnect-btn").addClass("connect-btn");else $(this).html(messages.js_connect)})}else{showSystemError()}}});return false});if(e[0]){$("#user-invite-form").submit(function(){var e=$(this);var t=e.closest(".updates-list-invite");var n=$("#updates-list-invite-count");var r=$('<div class="loading-wrap"><div class="loading-inner"></div></div>');t.append(r);$.ajaxQueue({type:"POST",url:e.attr("action"),data:e.serialize(),dataType:"json",cache:false,success:function(i){if(i.result==1){e.children("input[type=text]").removeClass("error_box").val("");$("#updates-list-invite-answer").html("").slideUp("fast");n.html(parseInt(n.html())-1);showStandardDialog(messages.js_invitation_sent,messages.js_invitation_msg);if(parseInt(n.html())==1){t.slideUp("fast").remove()}}else{e.children("input[type=text]").addClass("error_box");$("#updates-list-invite-answer").html(i.error).slideDown("fast")}r.remove()},error:function(){r.remove();showSystemError()}});return false})}$("a.updates-item-share-btn").live("click",function(){var e=$(this).prev();e.animate({width:parseInt(e.css("width"))==0?"108":"0"});return false});$("a.remote-share-action").live("click",function(){window.open($(this).attr("href"),"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=400,width=600");return false});$("a.local-share-action").live("click",function(){var e='<div title="'+messages.js_share+'"></div>';var t={};t[messages.js_share]=function(){var e=$(this);var t=$("#update-share-form form");var n=t.children("input[type=submit]");n.attr("disabled",true);var r=$('<div class="loading-wrap"><div class="loading-inner"></div></div>').hide();r.appendTo(t.parent().parent()).fadeIn("fast",function(){$.ajaxQueue({type:"POST",url:t.attr("action"),data:t.serialize(),dataType:"json",cache:false,success:function(i){if(i.result==1){t.children("textarea").val("").removeClass("error_box");$("#updates-list-share-answer").fadeOut("fast",function(){$(this).html("")});e.dialog("close")}else{i.fields=jQuery.parseJSON(i.fields);if(i.fields.comment!="")t.children("textarea").addClass("error_box");$("#updates-list-share-answer").html(i.html).fadeIn("fast")}n.removeAttr("disabled");r.remove()},error:function(){n.removeAttr("disabled");r.remove();showSystemError()}})})};$(e).load($(this).attr("href")).dialog({resizable:false,width:400,modal:true,buttons:t,close:function(){$.ajaxQueue({type:"GET",dataType:"json",url:base_url+"ajax/get_new_updates_count/"+$("#updates-list-refresh-last").val()+"/1",success:function(e){if(e.count>0)$("#updates-list-refresh").html(e.html).slideDown("fast");else $("#updates-list-refresh").html("").slideUp("fast");titleUpdatesCount(e.count)}})}});return false});$("#comment-textarea").focus(function(){$(this).animate({height:"4em"})});$("a.view-comments-action").live("click",function(){var e=$(this);var t=e.parent();var n=t.children(".updates-item-comments-wrap");var r=t.children(".updates-item-comment-form");var i=/\/(\d+)(?!.*\d)/g;var s=e.attr("href");var o=i.exec(s);var u=$('<div class="loading-btn"></div>');e.append(u);if(n.length){n.fadeTo("fast",.5,function(){$.ajaxQueue({type:"GET",url:base_url+"ajax/display_comment_list/"+o[1],cache:false,success:function(t){u.remove();e.updateCommentCount($(t).children().length);n.replaceWith(t)},error:function(){u.remove();showSystemError()}})});return false}$.ajaxQueue({type:"GET",url:base_url+"ajax/display_comment_list/"+o[1],cache:false,success:function(n){u.remove();var i=$(n).hide();if(r.length)i.insertBefore(r).fadeIn("fast");else i.appendTo(t).fadeIn("fast");e.updateCommentCount($(n).children().length)},error:function(){u.remove();showSystemError()}});return false});$("a.comment-btn-click").live("click",function(){var e=$(this);var t=e.parent();if(e.hasClass("selected")){e.removeClass("selected");t.children(".updates-item-comment-form").fadeOut("fast",function(){$(this).remove()})}else{var n=$('<div class="loading-btn"></div>');e.append(n);var r=/\/(\d+)(?!.*\d)/g;var i=e.attr("href");var s=r.exec(i);$.ajaxQueue({type:"GET",url:base_url+"ajax/display_comment_form/"+s[1],cache:false,success:function(r){e.addClass("selected");n.remove();$(r).insertNewHtml("appendTo",t)},error:function(){n.remove();showSystemError()}})}return false});$("#comment_form").live("submit",function(){var e=$(this);if(e.children("textarea").val()==""){e.children("textarea").addClass("error_box");return false}else{e.children("textarea").removeClass("error_box")}var t=e.prev();var n=t.parent().parent();var r=n.children(".updates-view-comments-btn");t.html('<div class="loading"></div>').fadeIn("fast",function(){$.ajaxQueue({type:"POST",url:base_url+"share/comment",data:e.serialize(),dataType:"json",cache:false,success:function(n){t.fadeOut("fast",function(){t.html("");if(n.result==1){var i=t.parent().prev();if(i.hasClass("updates-item-comments-wrap")){$(n.html_single).hide().appendTo(i).fadeIn("fast")}else{$(n.html).hide().insertBefore(t.parent()).fadeIn("fast")}e.children("textarea").val("");if(r.length)r.updateCommentCount(parseInt(r.html())+1)}else{$(n.html).hide().appendTo(t.show()).fadeIn("fast")}})},error:function(){showSystemError()}})});return false});$("a.comment-remove-action").live("click",function(){var e=$(this);$.ajaxQueue({type:"GET",url:e.attr("href"),dataType:"json",cache:false,success:function(t){if(t.result==1){var n=e.closest(".updates-list-item");var r=n.children(".updates-view-comments-btn");e.parent().fadeOut("fast",function(){$(this).remove();r.updateCommentCount(parseInt(r.html())-1)})}},error:function(){showSystemError()}});return false});var a=$("#notifications-link");if(a[0]){refreshNotifications();a.click(function(){var e=$(this);if(e.hasClass("selected")){e.removeClass("selected");var t=$("#notifications-window");if(t.length>0){t.hide();t.remove()}}else{var n=$('<div class="loading-btn"></div>');e.addClass("selected").append(n);$.ajaxQueue({type:"GET",url:e.attr("href"),cache:false,success:function(t){n.remove();$(t).hide().appendTo(e.parent()).show()},error:function(){n.remove();showSystemError()}})}return false});$(document).click(function(e){var t=$("#notifications-window");if(t.has(e.target).length===0&&e.target!==a&&a.hasClass("selected")){a.removeClass("selected");if(t.length>0){t.hide();t.remove()}}})}if(e[0]){$("#mark-all-read",e).click(function(){$.ajaxQueue({type:"GET",url:$(this).attr("href"),dataType:"json",cache:false,success:function(e){if(e.result==1){$("div.updates-list-item.unread").removeClass("unread");$("#notifications-link").html("Notifications")}},error:function(){showSystemError()}});return false})}if(e[0]){var f=$("div.fixed-block",e);if(f.length){var l=$("div.relative-block",e);$(window).scroll(function(){if($(window).scrollTop()>l.offset().top+l.outerHeight()-$("#top-navigation").outerHeight())f.css("position","fixed").css("top","32px");else f.css("position","relative").css("top","0")})}}var c=$("#top-navigation-menu-icon");if(c[0]){c.parent().removeClass("menu").find("ul").hide();c.click(function(){var e=c.parent();var t=$("#top-navigation-menu-window");if(e.hasClass("selected")){t.hide();e.removeClass("selected")}else{e.addClass("selected");t.show()}});$(document).click(function(e){var t=c.parent();var n=$("#top-navigation-menu-window");if(n.has(e.target).length===0&&$(e.target).attr("id")!==c.attr("id")&&t.hasClass("selected")){n.hide();t.removeClass("selected")}})}})